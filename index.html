<html>
<head>
<script>

var originalAppendChild = HTMLElement.prototype.appendChild;
HTMLElement.prototype.appendChild = function(element) {
    if (!element) return;

    if (element.tagName == "SCRIPT") {
        element.src = element.src.replace(origin, "https://orteil.dashnet.org/cookieclicker").replace("file", "https");
    } else if (element.tagName == "LINK") {
        element.href = element.href.replace(origin, "https://orteil.dashnet.org/cookieclicker").replace("file", "https");
    } else if (element.tagName == "IMG") {
        element.src = element.src.replace(origin, "https://orteil.dashnet.org/cookieclicker").replace("file", "https");
    }
	
	element.style.cssText = element.style.cssText.replace('url\("img\/', "url(https://orteil.dashnet.org/cookieclicker/img/");

    return originalAppendChild.call(this, element);
};

(async function() {
	
var html = await fetchHtml('https://orteil.dashnet.org/cookieclicker')     

const parser = new DOMParser();
const doc = parser.parseFromString(html, 'text/html');
const scriptTags = doc.querySelectorAll('script');

origin = document.baseURI.split("/")
origin.pop()
origin = origin.join("/")

var useScriptTags = new Array()
scriptTags.forEach(scriptTag => {
    if(scriptTag.text.includes("VERSION=")) {
		new Function(scriptTag.text.replaceAll("var", ""))();;
	}
	
	var scriptContent = scriptTag.src;
    scriptContent = scriptContent.replace(origin, "https://orteil.dashnet.org/cookieclicker").replace("file", "https")
    if(scriptContent && !scriptContent.includes("ad")) useScriptTags.push(scriptContent);
});

useScriptTags.forEach(scriptTag => {
		var script = document.createElement("script");
		script.src = scriptTag;
		document.head.append(script);	
});
	
Array.prototype.slice.call(doc.head.parentNode.getElementsByTagName("script")).forEach(script => {
	script.src = script.src.replace(origin, "https://orteil.dashnet.org/cookieclicker").replace("file", "https");
});

Array.prototype.slice.call(doc.head.parentNode.getElementsByTagName("link")).forEach(link => {
	link.href = link.href.replace(origin, "https://orteil.dashnet.org/cookieclicker").replace("file", "https");
});

Array.prototype.slice.call(doc.head.parentNode.getElementsByClassName("ad")).forEach(ad => {
	ad.parentNode.removeChild(ad);
});
	
document.head.parentNode.innerHTML = doc.head.parentNode.innerHTML.replaceAll('url(img/', "url(https://orteil.dashnet.org/cookieclicker/img/").replaceAll('"img/', '"https://orteil.dashnet.org/cookieclicker/img/').replaceAll("file", "https");;

})();

var fixAjax=function fetchData(url, callback) {
  if (url.startsWith("/")) url = "https://orteil.dashnet.org" + url;

  if (url.indexOf('?')==-1) url+='?'; else url+='&';
  url += 'nocache=' + Date.now();

  fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`)
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.text();
    })
    .then(data => {
      callback(JSON.parse(data)['contents'].substring(1));
    })
    .catch(error => {
      console.error('Fetch error:', error);
    });
}

function checkGame() {
    try {
		Game.resPath='https://cdn.dashnet.org/cookieclicker/';
		Game.local = false;
		ajax = fixAjax;
		OldPlaySound = function(url,vol) {};
		PlaySound = function(url,vol,pitchVar) {};
		PlayMusicSound = function(url,vol,pitchVar) {};
		
		Game.Launch = eval("(" + Game.Launch.toString().replaceAll('url(img/', "url(https://orteil.dashnet.org/cookieclicker/img/") + ")");

		window.onload();
	} catch(error) {
		window.setTimeout(checkGame, 100);
	}
}
checkGame();

function checkLinks() {
    try {
		if(document.getElementById("linkVersionLive")) throw new Error()
		
		Array.prototype.slice.call(document.getElementsByClassName("supportComment")).forEach(tag => {
			tag.parentNode.removeChild(tag)
		})
		
		document.getElementById("links").parentNode.removeChild(document.getElementById("links"));
	} catch(error) {
		window.setTimeout(checkLinks, 100);
	}
}
checkLinks();

function fetchHtml(url) {
    return fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`)
        .then(response => {
            if (response.ok) {
				return response.json().then(data => data.contents);
            } else {
                throw new Error('Network response was not ok.');
            }
        })
        .catch(error => {
            throw error;
        });
}

</script>
</head>
<body></body>
