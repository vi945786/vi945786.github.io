<html>
<head>

<link rel="shortcut icon" href="https://orteil.dashnet.org/cookieclicker/img/favicon.ico">

<script src="https://:cookiesaver-6dd8.restdb.io/assets/js/eventsource.min.js"></script>
<script src="https://cookiesaver-6dd8.restdb.io/rest/_jsapi.js?plainjs=true"></script>

<script>

var currentUrl = document.baseURI.split("/")
currentUrl.pop()
currentUrl = currentUrl.join("/")

var useAPI = (currentUrl == "https://vi945786.github.io/cc");
var db;
var saveFile;
var saved = 0;

var originalAppendChild = HTMLElement.prototype.appendChild;
HTMLElement.prototype.appendChild = function(element) {
    if (!element) return;

    if (element.tagName == "SCRIPT") {
        element.src = element.src.replace(currentUrl, "https://orteil.dashnet.org/cookieclicker").replace("file", "https");
		element.text = element.text.replace(currentUrl, "https://orteil.dashnet.org/cookieclicker").replace("file", "https");
    } else if (element.tagName == "LINK") {
        element.href = element.href.replace(currentUrl, "https://orteil.dashnet.org/cookieclicker").replace("file", "https");
    } else if (element.tagName == "IMG") {
        element.src = element.src.replace(currentUrl, "https://orteil.dashnet.org/cookieclicker").replace("file", "https");
    }
	
	if(element.style) element.style.cssText = element.style.cssText.replace('url\("img\/', "url(https://orteil.dashnet.org/cookieclicker/img/");

    return originalAppendChild.call(this, element);
};

if(useAPI) {
			
	db = new restdb("657af4b23fc01b465d5b055f", {realtime: true})
	
	db.on("SAVE", function(error, eventdata) {
		if(saved != 0) {
			saved--;
			return;
		}
		Game.CloseNotes();
		Game.ImportSaveCode(eventdata.data.game)
	})
	
	window.addEventListener("beforeunload", function(event) {
			
		if(!db) return;
		if(saveFile == undefined) return;
		
		save();
		
		var start = new Date().getTime();
		var end = start;
		while(end < start + 1500) {
			end = new Date().getTime();
		}
		
	});
}

(async function() { 
	var doc = await getDoc();
	
	doc.head.innerHTML = doc.head.innerHTML.replaceAll("url(img/", "url(https://orteil.dashnet.org/cookieclicker/img/").replaceAll("file", "https");
	doc.body.innerHTML = doc.body.innerHTML.replaceAll("url(img/", "url(https://orteil.dashnet.org/cookieclicker/img/").replaceAll("file", "https");

	Array.prototype.slice.call(doc.getElementsByClassName("adBanner")).forEach(ad => {
		ad.parentNode.removeChild(ad);
	});
	
	Array.prototype.slice.call(doc.getElementsByClassName("ad")).forEach(ad => {
		ad.parentNode.removeChild(ad);
	});
	
	Array.prototype.slice.call(doc.getElementsByClassName("ifNoAds")).forEach(ad => {
		ad.parentNode.removeChild(ad);
	});
	
	document.head.innerHTML = "";
	document.body.innerHTML = "";
	
	Array.prototype.slice.call(doc.body.childNodes).forEach(element => {
		if(element.tagName === "SCRIPT") {
			appendScript(element, document.body);
		} else {
			document.body.appendChild(element);
		}
	})
	
	Array.prototype.slice.call(doc.head.childNodes).forEach(element => {
		if(element.tagName === "SCRIPT") {
			appendScript(element, document.head);
		} else {
			document.head.appendChild(element);
		}
	})
	
	checkGame();
	checkLinks();
	autoSave();
})();

function saveButton() {
	saved++;
	var saveCode = save()
	if(useAPI) {
		db.publish('SAVE', {'game': saveCode}, function(error, result) {})
	}
}

function loadButton() {
	saveFile.reload(function(err, res) {
		saveFile = res;
		Game.CloseNotes()
		Game.ImportSaveCode(saveFile.savefile.game)
	})
}

function save() {
	var saveCode = getSave();
	if(useAPI) {
		saveFile.savefile.game = saveCode;
		saveFile.save();
	}
	return saveCode;
}

var fixAjax=function(url, callback) {
  if (!url.startsWith("http")) url = "https://orteil.dashnet.org" + url;

  if (url.indexOf('?')==-1) url+='?'; else url+='&';
  url += 'nocache=' + Date.now();

  fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`)
    .then(response => response.text())
    .then(data => callback(data));
}

var fixAddEvent=function(el,ev,func) {
	if(!el) return;
	if (el.addEventListener) {el.addEventListener(ev,func,false);return [el,ev,func];}
	else if (el.attachEvent) {var func2=function(){func.call(el);};el.attachEvent('on'+ev,func2);return [el,ev,func2];}
	return false;
}

function replaceMenu() {
	if(Game.onMenu=='prefs') {
		if(Game.Has('Wrapping paper') && Game.ascensionMode == 0) {
			l('menu').childNodes[3].childNodes[0].insertBefore(l('giftStuff'),l('menu').childNodes[3].childNodes[0].childNodes[1]);
			l('giftStuff').style.marginTop=-18;
		}
		
		l('menu').removeChild(l('menu').getElementsByClassName('block')[0]);
		 
		l('menu').insertBefore(new DOMParser().parseFromString('<div class="block" style="padding:0px;margin:8px 4px;"><div class="subsection" style="padding:0px;"><div class="title">Easy Access</div><div class="listing"><a style="width:250px;text-align:right;" class="option" onclick="focusLeft();PlaySound(\'snd/tick.mp3\');">Focus The Window On The Big Cookie</a><br><a style="width:250px;text-align:right;" class="option" onclick="focusUpgrades();PlaySound(\'snd/tick.mp3\');">Focus The Window On The Upgrades</a><br><a id="focusFarm" style="width:250px;text-align:right;" class="option" onclick="focusFarm();PlaySound(\'snd/tick.mp3\');">Focus The Window On The Farm</a><br><a id="focusStockMarket" style="width:250px;text-align:right;" class="option" onclick="focusStockMarket();PlaySound(\'snd/tick.mp3\');">Focus The Window On The Stock Market</a><br></div></div>', "text/html").body.firstChild, l('menu').lastChild)
		
		if(Game.Objects["Farm"].level == 0 || Game.ascensionMode != 0 || Game.Objects["Farm"].amount == 0) {
			l('focusFarm').parentNode.removeChild(l('focusFarm').parentNode.childNodes[5])
			l('focusFarm').parentNode.removeChild(l('focusFarm'))
		}
		if(Game.Objects["Bank"].level == 0 || Game.ascensionMode != 0 || Game.Objects["Bank"].amount == 0) {
			l('focusStockMarket').parentNode.removeChild(l('focusStockMarket').parentNode.lastChild)
			l('focusStockMarket').parentNode.removeChild(l('focusStockMarket'))
		}
		
	}else if(Game.onMenu=='stats'){
		var saveButton = document.createElement('div');
		saveButton.innerHTML = 'save';
		saveButton.style.fontSize=20;
		saveButton.onclick = window['saveButton'];
		saveButton.onmouseover=function(){saveButton.style.color='#888888'};
		saveButton.onmouseleave=function(){saveButton.style.color='#ffffff'};
		var div=document.createElement('div');
		div.appendChild(saveButton);
		div.style='display:flex;justify-content:center;align-items:center';
		l('menu').childNodes[1].insertBefore(div, l('menu').childNodes[1].firstChild);
		
		var loadButton = document.createElement('div');
		loadButton.innerHTML = 'load';
		loadButton.style.fontSize=20;
		loadButton.onclick = window['loadButton'];
		loadButton.onmouseover=function(){(loadButton.style.color='#888888')};
		loadButton.onmouseleave=function(){(loadButton.style.color='#ffffff')};
		div=document.createElement('div');
		div.appendChild(loadButton);
		div.style='display:flex;justify-content:center;align-items:center';l('menu').childNodes[1].appendChild(div);
	}
}

function checkGame() {
    try {
		Game.resPath='https://cdn.dashnet.org/cookieclicker/';
		Game.local = false;
		ajax = fixAjax;
		AddEvent = fixAddEvent;
		
		l('bigCookie').addEventListener('contextmenu', event => {l('bigCookie').click();return event.preventDefault()});
		l('support').parentNode.removeChild(l('support'));
		
		
		str = Game.Launch.toString();
		str = str.replaceAll('url(img/', "url(https://orteil.dashnet.org/cookieclicker/img/"); //fixes most the images
		str = str.replace("this.domain='';", "this.domain='https://orteil.dashnet.org/cookieclicker/img/';") //fixes more image problems
		str = str.replace("Game.toSave=true;e.preventDefault();", ""); //prevents ctrl+s to save (to prevent spamming the api)
		str = str.replace('Game.toSave=true', "save()"); //makes the game save to the server everytime it saves for any reason
		str = str.replaceAll("Game.prefs.autosave=", "//"); //removes autosaves (a diffrent implementation is used)
		str = str.replace("|| now-Game.lastClick<1000/((e?e.detail:1)===0?3:50)", ""); //removes security against faking a click event on the cookie using code (there is some code that turns right click to left click for when i'm playing on my laptop)
		str = str.replace("l('menu').innerHTML=str;", "l('menu').innerHTML=str;window['replaceMenu'].call()"); //changes the menu (see replaceMenu())
		str = str.replace("if (!quick) quick=6;", "if (!quick) quick=6;if(title == 'Achievement unlocked') quick=0") //makes achievement notifications stay forever even on short notifications mode
		str = str.replace("quick=Math.min(6,quick)", "quick=Math.min(3,quick)") //makes notifications disappear even faster on short notifications mode
		str = str.replace("l('versionNumber').innerHTML='v. '+Game.version", "l('versionNumber').innerHTML='v. '+Game.version//"); //removes the lock icon next to the version number ()
		Game.Launch = eval("(" + str + ")");
		
		if(useAPI) {
			localStorageSet("CookieClickerLang", "EN")
			new db.gamesaver.find({}, {}, function(err, res) {
				saveFile = res[0];
				localStorageSet("CookieClickerGame", saveFile.savefile.game)
				window.onload();
			})
		} else {
			window.onload();
		}

		
	} catch(error) {
		window.setTimeout(checkGame, 100);
	}
}

function checkLinks() {
    try {
		if(document.getElementById("linkVersionLive")) throw new Error()
		
		Array.prototype.slice.call(document.getElementsByClassName("supportComment")).forEach(tag => {
			tag.parentNode.removeChild(tag)
		})
		
		document.getElementById("links").parentNode.removeChild(document.getElementById("links"));
	} catch(error) {
		window.setTimeout(checkLinks, 100);
	}
}

function autoSave() {
	window.setTimeout(autoSave, ((10-new Date().getMinutes()%10)*60-new Date().getSeconds())*1000)
    try {
		Game;
		save();
	} catch(e) {}
}

async function getDoc() {
	var html = await fetchHtml('https://orteil.dashnet.org/cookieclicker')
	
	const parser = new DOMParser();
	var doc = parser.parseFromString(html, "text/html")
	
	var docHead = parser.parseFromString(html.split("head>")[1].slice(0, -2), "text/html")
	
	Array.prototype.slice.call(docHead.body.childNodes).forEach(element => {
		docHead.head.append(element)
	})
	
	var docBody = parser.parseFromString(html.split("body>")[1].slice(0, -2), "text/html")
	
	Array.prototype.slice.call(docBody.head.childNodes).forEach(element => {
		docBody.body.append(element)
	})
	
	doc.head.innerHTML = docHead.head.innerHTML;
	doc.body.innerHTML = docBody.body.innerHTML;
	
	return doc;
}

async function appendScript(element, parentNode) {
	var scriptType = element.src=='' ? "innerHTML" : "src";
	var scriptContent = element[scriptType];
	if(scriptContent.includes("ad")) return;
	
	var script = document.createElement("script");
	script[scriptType] = scriptContent.replace(currentUrl, "https://orteil.dashnet.org/cookieclicker").replace("file", "https");
	parentNode.append(script);
}

function fetchHtml(url) {
    return fetch("https://api.allorigins.win/raw?url=" + encodeURIComponent(url))
        .then(response => {
            if (response.ok) {
				return response.text();
            } else {
                throw new Error('Network response was not ok.');
            }
        })
        .catch(error => {
            throw error;
        });
}

function getSave() {
    Game.WriteSave()
    return localStorageGet("CookieClickerGame")
}

function focusLeft() {
	Array.from(l('sectionRight').getElementsByTagName("*")).forEach(node => node.style.visibility='hidden')
	Array.from(l('sectionMiddle').getElementsByTagName("*")).forEach(node => node.style.visibility='hidden')
	l('rightBeam').style.visibility='hidden'
	l('leftBeam').style.visibility='hidden'
	l('sectionRight').style.visibility='hidden'
	l('sectionMiddle').style.visibility='hidden'
	l('sectionLeft').style.width='100%'
	l('backgroundLeftCanvas').style.width='100%'

	resize()
	
	l('productLevel0').style.visibility = 'hidden'
	
	l('versionNumber').onclick = function(){unFocusLeft();PlaySound('snd/tick.mp3');}
	l('versionNumber').style.visibility = 'visible'
	l('versionNumber').onmouseover = function(){l('versionNumber').style.color='#888888'};
	l('versionNumber').onmouseleave = function(){l('versionNumber').style.color='#ffffff'};
}

function unFocusLeft() {
	Array.from(l('sectionRight').getElementsByTagName("*")).forEach(node => node.style.visibility='visible')
	Array.from(l('sectionMiddle').getElementsByTagName("*")).forEach(node => node.style.visibility='visible')
	l('rightBeam').style.visibility='visible'
	l('leftBeam').style.visibility='visible'
	l('sectionRight').style.visibility='visible'
	l('sectionMiddle').style.visibility='visible'
	l('sectionLeft').style.width=''
	l('backgroundLeftCanvas').style.width=''
	resize()
	
	l('productLevel0').style.visibility = 'visible'
	
	l('versionNumber').onclick = null
	l('versionNumber').onmouseover = null
	l('versionNumber').onmouseleave = null
	l('versionNumber').style.color='#ffffff'
}

function focusFarm() {
	Game.ShowMenu()
	
	window["miniGameOpen"] = Game.Objects["Farm"].onMinigame;
	Game.Objects["Farm"].switchMinigame(true)
	
	Array.from(l('game').getElementsByTagName("*")).forEach(node => node.style.visibility='hidden')
	
	l('gardenBG').style.visibility='visible'
	Array.from(l('gardenContent').getElementsByTagName("*")).forEach(node => node.style.visibility='visible')
	
	l('gardenBG').style.width='100%'
	l('gardenBG').style.height=window.innerHeight-TopBarOffset
	l('gardenBG').style.position='fixed'
	l('gardenBG').style.top=TopBarOffset
	l('gardenBG').style.left='0'
	
	l('gardenContent').style.width='100%'
	l('gardenContent').style.height=window.innerHeight-TopBarOffset
	l('gardenContent').style.position='fixed'
	l('gardenContent').style.top=TopBarOffset
	l('gardenContent').style.left='0'
	
	resize()
	
	var gardenSoilsTop = l('gardenSoils').getBoundingClientRect().top
	var gardenInfoTop = l('gardenInfo').getBoundingClientRect().top
	
	
	l('gardenPlotSize').style.top='35%'
	l('gardenPlot').style.top='35%'
	l('gardenInfo').style.top='35%'
	
	var gardenSoilsMoveDistance = l('gardenInfo').getBoundingClientRect().top+(gardenSoilsTop-gardenInfoTop)
	l('gardenSoils').childNodes.forEach(node => node.style.top=gardenSoilsMoveDistance-gardenSoilsTop)

	l('versionNumber').onclick = function(){unFocusFarm();PlaySound('snd/tick.mp3');}
	l('versionNumber').style.visibility = 'visible'
	l('versionNumber').onmouseover = function(){l('versionNumber').style.color='#888888'};
	l('versionNumber').onmouseleave = function(){l('versionNumber').style.color='#ffffff'};
}   

function unFocusFarm() {
	Array.from(l('game').getElementsByTagName("*")).forEach(node => node.style.visibility='visible')
	
	l('gardenBG').style.width=''
	l('gardenBG').style.height=''
	l('gardenBG').style.position=''
	l('gardenBG').style.top=''
	l('gardenBG').style.left=''
	
	l('gardenContent').style.width=''
	l('gardenContent').style.height=''
	l('gardenContent').style.position=''
	l('gardenContent').style.top=''
	l('gardenContent').style.left=''
	
	l('gardenPlotSize').style.top=''
	l('gardenPlot').style.top=''
	l('gardenInfo').style.top=''
	
	l('gardenSoils').childNodes.forEach(node => node.style.top='')
	resize()

	if(window["miniGameOpen"] == false) Game.Objects["Farm"].switchMinigame(0)
	
	l('versionNumber').onclick = null
	l('versionNumber').onmouseover = null
	l('versionNumber').onmouseleave = null
	l('versionNumber').style.color='#ffffff'
}  

function focusStockMarket() {
	Game.ShowMenu()
	window["miniGameOpen"] = Game.Objects["Bank"].onMinigame;
	Game.Objects["Bank"].switchMinigame(1)
	
	Array.from(l('game').getElementsByTagName("*")).forEach(node => node.style.visibility='hidden')
	
	
	l('bankBG').style.visibility='visible'
	Array.from(l('bankContent').getElementsByTagName("*")).forEach(node => node.style.visibility='visible')
	
	l('bankBG').style.width='100%'
	l('bankBG').style.height=window.innerHeight-TopBarOffset
	l('bankBG').style.position='fixed'
	l('bankBG').style.top=TopBarOffset
	l('bankBG').style.left='0'
	
	l('bankContent').style.width='100%'
	l('bankContent').style.height=window.innerHeight-TopBarOffset
	l('bankContent').style.position='fixed'
	l('bankContent').style.top=TopBarOffset
	l('bankContent').style.left='0'
	
	resize()
	
	l('versionNumber').onclick = function(){unFocusStockMarket();PlaySound('snd/tick.mp3');}
	l('versionNumber').style.visibility = 'visible'
	l('versionNumber').onmouseover = function(){l('versionNumber').style.color='#888888'};
	l('versionNumber').onmouseleave = function(){l('versionNumber').style.color='#ffffff'};
}

function unFocusStockMarket() {	
	Array.from(l('game').getElementsByTagName("*")).forEach(node => node.style.visibility='visible')
	
	l('bankBG').style.width=''
	l('bankBG').style.height=''
	l('bankBG').style.position=''
	l('bankBG').style.top=''
	l('bankBG').style.left=''
	
	l('bankContent').style.width=''
	l('bankContent').style.height=''
	l('bankContent').style.position=''
	l('bankContent').style.top=''
	l('bankContent').style.left=''
	
	resize()
	
	if(window["miniGameOpen"] == false) Game.Objects["Bank"].switchMinigame(0)
	
	l('versionNumber').onclick = null
	l('versionNumber').onmouseover = null
	l('versionNumber').onmouseleave = null
	l('versionNumber').style.color='#ffffff'
}

function focusUpgrades() {
	Array.from(l('game').getElementsByTagName("*")).forEach(node => node.style.visibility='hidden')
	
	Array.from(l('upgrades').getElementsByTagName("*")).forEach(node => node.style.visibility='visible')

    l('upgrades').style.visibility='visible'
	l('upgrades').style.width='100%'
	l('upgrades').style.height=window.innerHeight-TopBarOffset
	l('upgrades').style.position='fixed'
	l('upgrades').style.top=TopBarOffset
	l('upgrades').style.left='0'
	
	resize()
	
	l('versionNumber').onclick = function(){unFocusUpgrades();PlaySound('snd/tick.mp3');}
	l('versionNumber').style.visibility = 'visible'
	l('versionNumber').onmouseover = function(){l('versionNumber').style.color='#888888'};
	l('versionNumber').onmouseleave = function(){l('versionNumber').style.color='#ffffff'};
}

function unFocusUpgrades() {
	Array.from(l('game').getElementsByTagName("*")).forEach(node => node.style.visibility='visible')

    l('upgrades').style.visibility=''
	l('upgrades').style.width=''
	l('upgrades').style.height=''
	l('upgrades').style.position=''
	l('upgrades').style.top=''
	l('upgrades').style.left=''
	
	resize()
	
	l('versionNumber').onclick = null
	l('versionNumber').onmouseover = null
	l('versionNumber').onmouseleave = null
	l('versionNumber').style.color='#ffffff'
}

function resize() {
	Game.resize();
	Game.Background.canvas.width=Game.Background.canvas.parentNode.offsetWidth;
	Game.Background.canvas.height=Game.Background.canvas.parentNode.offsetHeight;
	Game.LeftBackground.canvas.width=Game.LeftBackground.canvas.parentNode.offsetWidth;
	Game.LeftBackground.canvas.height=Game.LeftBackground.canvas.parentNode.offsetHeight;
}

</script>
</head>
<body></body>
</html>